{% extends "inverso_sa/panel.html" %}

{% block title %}Usuarios — Panel{% endblock %}
{% block page_title %}Usuarios{% endblock %}

{% block content %}
<div id="usuarios-section">
    <div class="table-container">

        <h2 class="table-title">Usuarios</h2>

        <!-- FILTRO -->
        <form method="get" class="filter-bar">
            <select name="rol" onchange="this.form.submit()">
                <option value="">Todos</option>

                <option value="admin"
                    {% if filtro and filtro == 'admin' %}
                        selected
                    {% endif %}
                >
                    Administradores
                </option>

                <option value="user"
                    {% if filtro and filtro == 'user' %}
                        selected
                    {% endif %}
                >
                    Usuarios normales
                </option>
            </select>
        </form>

        <!-- TABLA -->
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nombre</th>
                    <th>Apellido</th>
                    <th>Email</th>
                    <th>Username</th>
                    <th>Rol</th>
                    <th>Estado</th>
                    <th>Fecha de Registro</th>
                    <th>Acciones</th>
                </tr>
            </thead>

            <tbody>
                {% for user in usuarios %}
                <tr>
                    <td>{{ user.id }}</td>
                    <td>{{ user.first_name }}</td>
                    <td>{{ user.last_name }}</td>
                    <td>{{ user.email }}</td>
                    <td>{{ user.username }}</td>
                    <td>{{ user.groups.first.name|default:"Usuario" }}</td>

                    <td>
                        {% if user.is_active %}
                            <span class="status-badge status-active">Activo</span>
                        {% else %}
                            <span class="status-badge status-inactive">Inactivo</span>
                        {% endif %}
                    </td>

                    <td>{{ user.date_joined|date:"d/m/Y H:i" }}</td>

                    <td class="action-buttons">

                        <!-- EDITAR -->
                        <a href="{% url 'editar_usuario' user.id %}" class="btn-edit">
                            Editar
                        </a>

                        <!-- ELIMINAR DEFINITIVO -->
                        <a href="{% url 'eliminar_usuario' user.id %}"
                           class="btn-delete">
                            Eliminar
                        </a>

                        <!-- ACTIVAR / DESACTIVAR -->
                        {% if user.is_active %}
                            <a href="{% url 'desactivar_usuario' user.id %}"
                               class="btn-disable"
                               onclick="return confirm('¿Deseas desactivar este usuario?');">
                                Desactivar
                            </a>
                        {% else %}
                            <a href="{% url 'activar_usuario' user.id %}"
                               class="btn-enable"
                               onclick="return confirm('¿Deseas activar este usuario?');">
                                Activar
                            </a>
                        {% endif %}

                    </td>
                </tr>

                {% empty %}
                <tr>
                    <td colspan="9">No hay usuarios registrados</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

    </div>
</div>
{% endblock %}
