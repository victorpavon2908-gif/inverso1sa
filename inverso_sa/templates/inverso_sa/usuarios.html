{% extends "inverso_sa/panel.html" %}
{% load static %}

{% block title %}Usuarios â€” Panel{% endblock %}
{% block page_title %}Usuarios{% endblock %}

{% block css %}
<link rel="stylesheet" href="{% static 'inverso_sa/css/usuarios.css' %}">
{% endblock %}

{% block content %}
<div id="usuarios-section">

    <div class="table-container">

        <div class="users-header">
            <h2 class="table-title">Usuarios</h2>

            <form method="get" class="filter-bar">
                <select name="rol" onchange="this.form.submit()">
                    <option value="">Todos</option>
                    <option value="admin" {% if filtro == 'admin' %}selected{% endif %}>
                        Administradores
                    </option>
                    <option value="user" {% if filtro == 'user' %}selected{% endif %}>
                        Usuarios normales
                    </option>
                </select>
            </form>
        </div>

        <div class="table-responsive">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Apellido</th>
                        <th>Email</th>
                        <th>Usuario</th>
                        <th>Rol</th>
                        <th>Estado</th>
                        <th>Registro</th>
                        <th>Acciones</th>
                    </tr>
                </thead>

                <tbody>
                {% for user in usuarios %}
                    <tr>
                        <td>{{ user.id }}</td>
                        <td>{{ user.first_name }}</td>
                        <td>{{ user.last_name }}</td>
                        <td>{{ user.email }}</td>
                        <td>{{ user.username }}</td>
                        <td>{{ user.groups.first.name|default:"Usuario" }}</td>

                        <td>
                            {% if user.is_active %}
                                <span class="badge active">Activo</span>
                            {% else %}
                                <span class="badge inactive">Inactivo</span>
                            {% endif %}
                        </td>

                        <td>{{ user.date_joined|date:"d/m/Y" }}</td>

                        <td class="actions">
                            <a href="{% url 'editar_usuario' user.id %}" class="btn edit">Editar</a>
                            <a href="{% url 'eliminar_usuario' user.id %}" class="btn delete">Eliminar</a>

                            {% if user.is_active %}
                                <a href="{% url 'desactivar_usuario' user.id %}" class="btn warning">Desactivar</a>
                            {% else %}
                                <a href="{% url 'activar_usuario' user.id %}" class="btn success">Activar</a>
                            {% endif %}
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="9" class="empty">No hay usuarios registrados</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>

    </div>

</div>
{% endblock %}
